import{c as S,f as $}from"./share.JQ5RqDI2.js";import{s as _,e as F,S as b,o as j,w as E,f as g,m as R,p as H,u as d,B as v,h as w,t as k,k as h,a7 as A,aa as K,l as x,J as L,K as q,q as I,a1 as J}from"./framework.B8UBlkKL.js";import{u as B}from"./theme.CfQsADRn.js";import{_ as P}from"./CardLayout.vue_vue_type_script_setup_true_lang.CEdjuEfn.js";const D=()=>new Date().getTime(),U=()=>{const e=new Date;if(e.getHours()<4){const n=e.getTime();e.setTime(n-z/2)}return e.setHours(4,0,0,0),e.getTime()},M=U(),z=864e5,y=e=>Math.round(e/z),T=e=>e*z;function N(e,n){const a=D(),i=M;if(e.state===1){if(n===3){const c=y(a-e.last)+1,t=e.ease*1.4,l=M+T(c*t);return console.log("review after "+Math.round(c*t)+" days."),{...e,state:2,due:l,last:a,ease:2.3,difficulty:1}}const s=[1,6,10][n]*60*1e3,u=a+s;return{...e,due:u}}if(e.state===2){if(n===0)return{...e,state:3,due:a+6e4,last:a,lastSpan:y(a-e.last)};let o,s;switch(n){case 1:o=e.ease-.15,o<1.3&&(o=1.3),s=1.2;break;case 2:o=e.ease,s=2;break;default:o=e.ease+.15,o>2.5&&(o=2.5),s=o*.14;break}const u=y(i-e.last);let c=y(e.due-i);c<0&&(c=0);const t=s*(u+c/e.difficulty);console.log(`review after ${Math.round(t)} later.`);const l=i+T(t),f=1<<3-n;return{...e,due:l,last:i,ease:o,difficulty:f}}if(n===3){let o=e.ease+.15;o>2.5&&(o=2.5);const s=o*1.4,u=y(a-e.last)+1,c=s*(u+e.lastSpan*2);console.log(`review after ${Math.round(c)} later.`);const t=M+T(c);return{...e,state:2,due:t,last:a,ease:o,difficulty:1}}const r=[1,6,10][n]*60*1e3,p=a+r;return{...e,due:p}}const C=()=>performance.now();function W(e,n){const a=B(`yima_${n}_anki`,[]),i=B(`yima_${n}_progress`,{meet:0,familiar:0}),m=_();let r,p=C();const o=()=>{const c=D();a.value.sort((f,V)=>f.due-V.due);const t=a.value;if(t.length&&t[0].due<=c){r=!0,m.value=e[t[0].index];return}const l=i.value.meet;if(l<e.length){r=!1,m.value=e[l];return}r=!0,m.value=e[t[0].index]};return o(),{progress:i,answer:(c=!0)=>{let t=0;if(c){const l=C()-p;l<1e3?t=3:l<2500?t=2:t=1}if(r)a.value[0]=N(a.value[0],t);else{const l=D(),f=N({state:1,due:l,last:l,ease:2.3,index:i.value.meet},t);a.value.push(f),i.value.meet+=1}t===3&&(i.value.familiar+=1),o(),p=C()},card:m,restart:()=>{a.value=[],i.value.familiar=0,i.value.meet=0,o()}}}const G={class:"flex justify-around mb-8"},O={class:"flex justify-center p-5"},Q={class:"font-mono"},X=F({__name:"TrainAnki",props:{cards:{},name:{}},setup(e){const n=e,a=b("font")||"outi-yima",i=b("high"),{progress:m,card:r,answer:p,restart:o}=W(n.cards,n.name),s=_(!0),u=_("");j(()=>{const t=document.getElementById("input_el");t==null||t.focus()}),E(u,t=>{t.length<r.value.key.length||(t===r.value.key?(p(s.value),s.value=!0):s.value=!1,u.value="")});const c=()=>{confirm("重置进度需要清空数据，无法撤回，您确定继续吗？")&&o()};return(t,l)=>(g(),R(P,{progress:d(m).familiar,max:t.cards.length,isCorrect:s.value,id:t.name,onRestart:c},{default:H(()=>[v("div",G,[(g(),w("div",{key:d(r).name,class:h(["text-6xl animate__animated","kaiti-zigen",{"text-red-400":!s.value,animate__headShake:!s.value}])},k(d(r).name),3))]),v("div",O,[A(v("input",{id:"input_el",type:"text",placeholder:"输入编码","onUpdate:modelValue":l[0]||(l[0]=f=>u.value=f),class:h(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!s.value}])},null,2),[[K,u.value]])]),v("div",{class:h(["text-center",{"opacity-0":s.value}])},[l[3]||(l[3]=x("答案是 ")),v("b",Q,k(d(r).key),1),"comp"in d(r)?(g(),w("span",{key:0,class:h([d(a),"tracking-widest opacity-80"])},[l[1]||(l[1]=x(" (")),(g(!0),w(L,null,q(d(r).comp,f=>(g(),w("span",{class:h({"round-bg":d(i).has(f)})},k(f),3))),256)),l[2]||(l[2]=x(")"))],2)):I("",!0)],2)]),_:1},8,["progress","max","isCorrect","id"]))}}),Y={key:1,class:"text-gray-700"},ne=F({__name:"TrainHanzi",props:{name:{},chaiJson:{},range:{},zigenJson:{},zigenFont:{},high:{}},setup(e){const n=e;J("font",n.zigenFont),J("high",new Set(n.high));let a=n.name+"_single";const i=n.range;i&&(a+=`_${i[0]}_${i[1]}`);const m=_(S[a]);return j(async()=>{if(m.value)return;let r=await $(n.chaiJson);if(i&&(r=r.slice(i[0],i[1])),n.zigenJson){const p=await $(n.zigenJson),o=new Map(p.map(s=>[s.name,s.key]));for(const s of r)if(!s.key){if(!s.comp){const u=`${n.zigenJson} 文件里 ${s} 没有comp字段也没有key字段`;throw alert(u),new Error(u)}s.key=[...s.comp].map(u=>o.get(u)||"").join("")}}return S[a]=r,m.value=r}),(r,p)=>m.value?(g(),R(X,{key:0,name:d(a),cards:m.value},null,8,["name","cards"])):(g(),w("h2",Y," 下载数据中…… "))}});export{ne as _};
