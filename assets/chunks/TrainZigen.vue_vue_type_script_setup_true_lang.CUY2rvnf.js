import{f as J,c as S}from"./share.DCBjyfVi.js";import{g as j}from"./share.DGSJN8BX.js";import{s as C,j as E,W as R,o as M,w as I,x as Z,p,u as n,y as T,E as v,k as _,z as y,m as b,v as k,M as F,N as V,aa as L,ad as W,q as D,a4 as z}from"./framework.C5AoO3Cs.js";import{u as P}from"./theme.CEDVJPM0.js";import{_ as q}from"./CardLayout.vue_vue_type_script_setup_true_lang.n2-rqy72.js";function A(w,o){if(o.length<100)throw new Error(`卡片至少100张：${o.length}`);const h=()=>Array.from({length:o.length},(e,t)=>[-1,t]),s=P(`yima_${w}_records`,h),c=o.length;if(s.value.length<c)for(let e=s.value.length;e<c;e++)s.value.push([-1,e]);else s.value.length>c&&(s.value=s.value.filter(e=>e[1]<c));s.value.sort((e,t)=>e[0]===8&&t[0]<8?1:t[0]===8&&e[0]<8?-1:0);const u=C(s.value.reduce((e,t)=>e+ +(t[0]>1),0)),d=C(o[s.value[0][1]]),a=C(s.value[0][0]===-1),$=()=>{s.value=h(),u.value=0,a.value=!0,d.value=o[0]},m=o.length-1,x=[3,9,21,36,60,100],B=x.length-1;return{progress:u,card:d,isFirst:a,restart:$,answer:e=>{if(!e){s.value[0][0]>1&&(u.value-=1),s.value[0][0]=-1,a.value=!0;return}const t=s.value[0],f=++t[0];f===2&&(u.value+=1);let g=0;f>B?(t[0]=8,g=m):(g=x[f],g>m&&(g=m)),s.value.copyWithin(0,1,g+1),s.value[g]=t,d.value=o[s.value[0][1]],a.value=s.value[0][0]===-1}}}const U={class:"flex justify-center items-center mb-8"},G={key:0,class:"flex flex-col"},H={key:0,class:"flex tracking-widest flex-col opacity-80"},K={class:"my-1"},O={class:"text-sm"},Q={key:1,class:"tracking-widest pt-6 text-blue-600 dark:text-blue-300"},X={key:2,class:"tracking-widest pt-6 text-blue-600 dark:text-blue-300"},Y={class:"flex justify-center p-5"},ee={class:"font-mono"},te=E({__name:"TrainCard",props:{cards:{},id:{}},setup(w){const o=w,h=R("font")||"outi-yima",s=R("hasClass")||!1;let c=structuredClone(o.cards);if(s){const e=[],t=new Map,f=[];for(let l=0;l<c.length;l++){const i=c[l];i._idx=l,!i.class||i.class===i.name?(e.push(i),t.set(i.name,i)):f.push(i)}let g=!1;for(const l of f){const i=t.get(l.class);if(!i){console.error(`字根${l.name}的归类是「${l.class}」，但没有找到这个字根`),e.push(l),t.set(l.name,l),g=!0;continue}i._classZigen?i._classZigen.push(l):i._classZigen=[l]}g&&e.sort((l,i)=>l._idx-i._idx),c=e}const{card:r,restart:u,answer:d,progress:a,isFirst:$}=A(o.id,c),m=C(!0),x=C(""),B=()=>{const e=document.getElementById("input_el");e==null||e.focus()};M(()=>{B()});function N(){confirm("重置进度需要清空数据，无法撤回，您确定继续吗？")&&(u(),B())}return I(x,e=>{e.length<r.value.key.length||(e===r.value.key?(d(!0),m.value=!0):(d(!1),m.value=!1),x.value="")}),(e,t)=>(p(),Z(q,{progress:n(a),max:n(c).length,isCorrect:m.value,id:e.id,onRestart:N},{default:T(()=>[v("div",U,[v("div",{class:b(["text-6xl mr-12 align-middle animate__animated",n(h),{"text-red-400":!m.value,animate__headShake:!m.value}])},k(n(r).name),3),"rel"in n(r)||"kind"in n(r)?(p(),_("div",G,["rel"in n(r)?(p(),_("div",H,[t[2]||(t[2]=v("div",{class:"text-gray-500 text-sm"}," 相关的字：",-1)),v("div",null,k(n(r).rel),1),n(r)._classZigen?(p(),_(F,{key:0},[t[1]||(t[1]=v("div",{class:"text-gray-500 text-sm mt-4 mb-2"}," 相似字根：",-1)),(p(!0),_(F,null,V(n(r)._classZigen,f=>(p(),_("div",K,[v("span",{class:b(["opacity-100 text-xl mr-2",n(h),{"text-red-400":!m.value,animate__headShake:!m.value}])},k(f.name),3),v("span",O,k(f.rel),1)]))),256))],64)):y("",!0)])):y("",!0),"kind"in n(r)&&n(r).kind=="b"?(p(),_("div",Q," 五个基础笔画")):y("",!0),"kind"in n(r)&&n(r).kind=="eb"?(p(),_("div",X," 25个二笔小码")):y("",!0)])):y("",!0)]),v("div",Y,[L(v("input",{id:"input_el",type:"text",placeholder:"输入编码","onUpdate:modelValue":t[0]||(t[0]=f=>x.value=f),class:b(["input w-half max-w-xs input-bordered text-center input-sm dark:bg-slate-800 bg-white",{"input-error":!m.value}])},null,2),[[W,x.value]])]),v("div",{class:b(["text-center",{"opacity-0":!n($)}])},[t[3]||(t[3]=D("答案是 ")),v("b",ee,k(n(r).key),1),"comp"in n(r)?(p(),_("span",{key:0,class:b([n(h)])}," （"+k(n(r).comp)+"）",3)):y("",!0)],2)]),_:1},8,["progress","max","isCorrect","id"]))}}),se={key:1,class:"text-gray-700 text-center"},ie=E({__name:"TrainZigen",props:{name:{},zigenJson:{},zigenFont:{},trainSecondary:{type:Boolean},trainBoth:{type:Boolean},hasClass:{type:Boolean}},setup(w){const o=w;z("font",o.zigenFont),z("hasClass",o.hasClass);const h=j(),c=`${o.name||h}_gen`,r=(d,a)=>d||`/${h}/${a}.json`,u=C(S[c]);return M(async()=>{if(u.value)return;const d=await J(r(o.zigenJson,"zigen"));o.trainSecondary?u.value=d.filter(a=>"secondary"in a).map(a=>({...a,key:a.secondary})):o.trainBoth?u.value=d.filter(a=>"secondary"in a).map(a=>({...a,key:a.key+a.secondary})):u.value=d,S[c]=u.value}),(d,a)=>u.value?(p(),Z(te,{key:0,id:c,cards:u.value},null,8,["cards"])):(p(),_("h2",se," 下载数据中…… "))}});export{ie as _};
