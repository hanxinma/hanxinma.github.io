import{j as z,k as v,p as d,M as g,l as w,E as i,N as y,v as x,a as $,f as _,w as M,Q as H,aa as A,ad as F,y as I,q as Q,m as S,n as j,s as R,o as U,x as G,u as O}from"./framework.DA7r4KNg.js";import{f as N}from"./share.CTKjlkg8.js";let L={};const X=a=>new Map(a.map(e=>[e.name,e]));function D(a,e){return a===e?0:a<e?-1:1}function Y(a,e){return D(a.key,e.key)}function Z(a,e){if(e==="")return[0,a.length];const t=E(a,e,0,T);if(t<0)throw new Error(`cannot find prefix(top) ${e}`);const s=E(a,e,t,ee);return s<0?null:[t,s]}function B(a,e){const t=E(a,e,0,T);return t<0||!a[t].key.startsWith(e)?null:t}function E(a,e,t,s){let n=t;const h=s(a,e,n);if(h===0)return n;if(h<0)return-1;let f=a.length-1;const m=s(a,e,f);if(m===0)return f+1;if(m>0)return-1;let c=n+(f-n)/2|0,k=s(a,e,c);for(;k!==0;){if(f-n===1)return f;k>0?n=c:f=c,c=n+(f-n)/2|0,k=s(a,e,c)}return c}function T(a,e,t){const s=C(a[t],e),n=t===0?!1:C(a[t-1],e);return s?n?-1:0:n?-1:D(e,a[t].key)}function ee(a,e,t){const s=C(a[t],e);if(s&&t===a.length-1)return 0;const n=t===0?!1:C(a[t-1],e);return s?1:n?0:D(e,a[t].key)}function C(a,e){return a.key.startsWith(e,0)}const te={class:"text-xl bg-neutral-50 dark:bg-neutral-900 max-w-screen-sm text-slate-900 dark:text-slate-400 select-none"},ne={class:"flex min-h-9 h-9 text-base bg-neutral-100 dark:bg-neutral-800 pt-1 break-keep text-nowrap"},se={class:"flex text-center"},ae=["onClick"],le={key:0,class:"flex text-center"},oe=["onClick"],re={key:1,class:"flex text-center"},ue=["onClick"],ie={class:"flex text-center"},ce=["onClick"],de=z({__name:"Keyboard",props:{layout:{},enable:{type:Boolean},active:{}},emits:["click"],setup(a){return(e,t)=>(d(),v(g,null,[w(e.$slots,"codes"),i("div",te,[i("div",ne,[w(e.$slots,"cadidate")]),i("div",se,[(d(),v(g,null,y("qwertyuiop",s=>i("button",{class:"flex-1 hover:bg-slate-300 hover:dark:bg-slate-800 py-4",onClick:n=>e.$emit("click",s)},x(s),9,ae)),64))]),e.layout===26?(d(),v("div",le,[t[1]||(t[1]=i("div",{class:"flex-5"},null,-1)),(d(),v(g,null,y("asdfghjkl",s=>i("button",{class:"flex-1 hover:bg-slate-300 hover:dark:bg-slate-800 py-4",onClick:n=>e.$emit("click",s)},x(s),9,oe)),64)),t[2]||(t[2]=i("div",{class:"flex-5"},null,-1))])):(d(),v("div",re,[(d(),v(g,null,y("asdfghjkl;",s=>i("button",{class:"flex-1 hover:bg-slate-300 hover:dark:bg-slate-800 py-4",onClick:n=>e.$emit("click",s)},x(s),9,ue)),64))])),i("div",ie,[t[4]||(t[4]=i("div",{class:"flex-1"},null,-1)),(d(),v(g,null,y("zxcvbnm",s=>i("button",{class:"flex-1 hover:bg-slate-300 hover:dark:bg-slate-800 py-4",onClick:n=>e.$emit("click",s)},x(s),9,ce)),64)),i("button",{class:"flex-2 text-neutral-400 hover:bg-slate-300 hover:dark:bg-slate-800 flex justify-center items-center",onClick:t[0]||(t[0]=s=>e.$emit("click","bs"))},t[3]||(t[3]=[i("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24"},[i("path",{fill:"currentColor",d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2m-3 12.59L17.59 17L14 13.41L10.41 17L9 15.59L12.59 12L9 8.41L10.41 7L14 10.59L17.59 7L19 8.41L15.41 12"})],-1)]))])])],64))}}),ve={class:"pt-3"},fe={key:0,class:"h-4"},pe={key:1,class:"text-xs bg-neutral-200 dark:bg-neutral-900 w-max px-2 h-4 select-none"},he={key:0,class:"text-sm text-slate-500 ml-6 mt-1"},me={key:1,class:"text-sm text-slate-400 dark:text-slate-500 ml-6 mt-1"},ge={class:"flex-auto overflow-x-auto overflow-y-hidden"},xe=["onClick"],ke={class:"text-sm text-slate-400 dark:text-slate-500"},be={class:"select-text px-1 text-slate-900 dark:text-slate-200"},_e={class:"text-sm text-blue-400 dark:text-blue-500 dark:opacity-70"},ye={class:"float-right mx-2"},$e=["disabled"],we=["disabled"],Ce=z({__name:"InputMethod",props:{id:{},data:{},rule:{}},setup(a){const e=a,t=$(""),s=_(()=>{const o=t.value;if(!o)return[];const l=Z(e.data,o);return l?e.data.slice(l[0],l[1]):[]}),n=$(0),h=_(()=>s.value.length?s.value.slice(n.value*5,(n.value+1)*5):[]),f=_(()=>n.value<1),m=_(()=>n.value>s.value.length/5-1),c=$(""),k=$();function P(o){if(o==="bs"){t.value?t.value=t.value.slice(0,-1):c.value=c.value.slice(0,-1);return}t.value+=o,n.value=0}function b(o){const l=k.value,{selectionStart:r,selectionEnd:u}=l;if(r===0&&u===0){c.value+=o,j(()=>l.selectionEnd=c.value.length);return}const p=c.value.slice(0,r),W=c.value.slice(u);c.value=p+o+W,j(()=>{l.selectionEnd=r+o.length})}function V(o){b(o.name),n.value=0,t.value=""}M(s,o=>{if(o.length>0)return;const l=e.rule.autoCm;let r=t.value;if(r.length<l+1)return;let u=null;do{if(r=r.slice(0,-1),r.length===0)return;u=B(e.data,r)}while(u===null);b(e.data[u].name),t.value=t.value.at(-1)||""}),M(t,o=>{const l=e.rule.pop,r=e.rule.len;if(o.length>r)if(l){const u=B(e.data,o.slice(0,l));u!==null&&(b(e.data[u].name),t.value=o.slice(l))}else{const u=B(e.data,o.slice(0,r));u!==null&&b(e.data[u].name),t.value=o.slice(r)}});const q=new Set(`abcdefghijklmnopqrstuvwxyz${e.rule.keys===27?";":""}`),J=_(()=>{const{cm1:o,cm2:l,cm3:r}=e.rule,u=new Map;u.set(o,0),u.set(l,1),u.set(r,2);for(let p=0;p<5;p++)u.set(String(p+1),p);return u});function K(o){const{key:l}=o,r=t.value;if(q.has(l)){o.preventDefault(),t.value+=l,n.value=0;return}if(J.value.has(l)){const p=J.value.get(l);p<h.value.length&&(o.preventDefault(),b(h.value[p].name),t.value="",n.value=0);return}if(l==="Backspace"&&r){o.preventDefault(),t.value=r.slice(0,-1);return}if(l==="Escape"&&r){o.preventDefault(),t.value="";return}const u=n.value;if(l==="-"&&r&&u>0){o.preventDefault(),n.value--;return}l==="="&&r&&u+1<s.value.length/5&&(o.preventDefault(),n.value++)}return(o,l)=>(d(),v(g,null,[i("div",ve,[A(i("textarea",{"onUpdate:modelValue":l[0]||(l[0]=r=>c.value=r),ref_key:"textarea",ref:k,class:"textarea textarea-bordered textarea-md w-full max-w-screen-sm bg-neutral-50 dark:bg-neutral-700",style:{"border-style":"solid"},placeholder:"点击这里开始输入",onKeydown:K},null,544),[[F,c.value]])]),H(de,{layout:26,enable:"",onClick:P},{codes:I(()=>[t.value===""?(d(),v("div",fe)):(d(),v("div",pe,x(t.value),1))]),cadidate:I(()=>[s.value.length===0?(d(),v(g,{key:0},[t.value.length===0?(d(),v("div",he,[w(o.$slots,"default",{},()=>[l[3]||(l[3]=Q("按下键盘或点击下方按钮"))])])):(d(),v("div",me,"空码"))],64)):(d(),v(g,{key:1},[i("div",ge,[(d(!0),v(g,null,y(h.value,(r,u)=>(d(),v("button",{class:"px-2 hover:bg-slate-200 dark:hover:bg-slate-900",onClick:p=>V(r)},[i("span",ke,x(u+1)+".",1),i("span",be,x(r.name),1),i("span",_e,x(r.key.slice(t.value.length)),1)],8,xe))),256))]),i("div",ye,[i("button",{class:S({"text-transparent":f.value}),disabled:f.value,onClick:l[1]||(l[1]=r=>n.value--)},"◂",10,$e),i("button",{class:S({"text-transparent":m.value}),disabled:m.value,onClick:l[2]||(l[2]=r=>n.value++)},"▸",10,we)])],64))]),_:3})],64))}}),Le={key:0,class:"text-gray-600 text-center"},Ee=z({__name:"FetchInput",props:{chaifenJson:{},zigenJson:{},id:{},rule:{}},setup(a){const e=a,t=e.id||e.chaifenJson,s=R();return U(async()=>{if(t in L){s.value=L[t];return}const n=await N(e.chaifenJson);if(e.zigenJson){const h=await N(e.zigenJson),f=X(h);for(const m of n)m.key||(m.key=[...m.comp].map(c=>f.get(c).key).join(""))}n.sort(Y),s.value=n,L[t]=n}),(n,h)=>s.value?(d(),G(Ce,{key:1,id:O(t),rule:n.rule,data:s.value},{default:I(()=>[w(n.$slots,"default")]),_:3},8,["id","rule","data"])):(d(),v("div",Le,"加载中……"))}});export{Ee as _};
